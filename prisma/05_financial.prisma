model Bill {
    id          String     @id @default(cuid())
    type        BillType
    description String
    amount      Decimal?
    amountPaid  Decimal?
    dueDate     DateTime
    paymentDate DateTime?
    status      BillStatus

    installments      Int     @default(1)
    installmentNumber String?

    recurrence        RecurrenceType?
    recurrenceEndDate DateTime? 
    recurrenceCount   Int?
    complement        String?

    parentId String?
    parent   Bill?   @relation("BillHierarchy", fields: [parentId], references: [id], onDelete: Cascade)
    children Bill[]  @relation("BillHierarchy")

    subscriptionId    String?
    subscription      Subscription?    @relation(fields: [subscriptionId], references: [id])

    saleId String?
    sale   Sale?   @relation(fields: [saleId], references: [id])

    studentId String?
    student   Student? @relation(fields: [studentId], references: [id])

    supplierId String?
    supplier   Supplier? @relation(fields: [supplierId], references: [id])

    categoryId String?
    category   CategoryBill? @relation(fields: [categoryId], references: [id])

    paymentMethodId String?
    paymentMethod   PaymentMethod? @relation(fields: [paymentMethodId], references: [id])

    bankId String?
    bank   Bank?   @relation(fields: [bankId], references: [id])

    attachments BillAttachment[]

    tenancyId String
    tenancy   Tenancy @relation(fields: [tenancyId], references: [id])

    createdAt DateTime @default(now())
    updatedAt DateTime @updatedAt

    @@schema("financial")
}

model Sale {
  id        String    @id @default(cuid())
  tenancyId String
  studentId String
  
  totalAmount Decimal
  
  items     SaleItem[]
  bills     Bill[]

  student   Student?   @relation(fields: [studentId], references: [id])
  tenancy   Tenancy   @relation(fields: [tenancyId], references: [id], onDelete: Cascade)
  
  createdAt DateTime @default(now())
  @@schema("financial")
}

model SaleItem {
  id          String   @id @default(cuid())
  saleId      String
  
  description String
  unitAmount  Decimal
  quantity    Int      @default(1)
  
  planId      String?  
  plan        Plan?    @relation(fields: [planId], references: [id])
  
  // Futuramente:
  // productId   String?
  // product     Product? @relation(fields: [productId], references: [id])
  
  sale        Sale     @relation(fields: [saleId], references: [id], onDelete: Cascade)
  
  @@schema("financial")
}

enum BillType {
    PAYABLE
    RECEIVABLE

    @@schema("financial")
}

enum BillStatus {
    PENDING
    PAID
    OVERDUE
    CANCELLED

    @@schema("financial")
}

enum RecurrenceType {
    NONE
    MONTHLY
    BIMONTHLY
    QUARTERLY
    SEMIANNUAL
    ANNUAL

    @@schema("financial")
}

model BillAttachment {
    id     String @id @default(cuid())
    url    String
    billId String
    bill   Bill   @relation(fields: [billId], references: [id], onDelete: Cascade)

    createdAt DateTime @default(now())

    @@schema("financial")
}

model Bank {
    id          String  @id @default(cuid())
    name        String
    code        String?
    agency      String?
    account     String?
    description String?

    maintenanceFeeAmount Decimal?
    maintenanceFeeDue    Int?

    bills Bill[]

    tenancyId String
    tenancy   Tenancy @relation(fields: [tenancyId], references: [id])

    createdAt DateTime @default(now())
    updatedAt DateTime @updatedAt

    @@schema("financial")
}

model CategoryBill {
    id     String           @id @default(cuid())
    name   String
    nature BillNature
    type   BillCategoryType

    parentId String?
    parent   CategoryBill?  @relation("CategoryParent", fields: [parentId], references: [id])
    children CategoryBill[] @relation("CategoryParent")

    groupId String?
    group   CategoryGroup? @relation(fields: [groupId], references: [id])

    bills Bill[]

    tenancyId String
    tenancy   Tenancy @relation(fields: [tenancyId], references: [id])

    createdAt DateTime @default(now())
    updatedAt DateTime @updatedAt

    @@schema("financial")
}

enum BillNature {
    REVENUE
    EXPENSE

    @@schema("financial")
}

enum BillCategoryType {
    FIXED
    VARIABLE

    @@schema("financial")
}

model CategoryGroup {
    id   String @id @default(cuid())
    name String

    categories CategoryBill[]

    tenancyId String
    tenancy   Tenancy @relation(fields: [tenancyId], references: [id])

    @@schema("financial")
}

model PaymentMethod {
    id       String  @id @default(cuid())
    name     String
    operator String?

    fees     PaymentFee[]
    bills    Bill[]
    teachers Teacher[]

    tenancyId String
    tenancy   Tenancy @relation(fields: [tenancyId], references: [id])

    createdAt DateTime @default(now())
    updatedAt DateTime @updatedAt

    @@schema("financial")
}

model PaymentFee {
    id               String        @id @default(cuid())
    paymentMethodId  String
    paymentMethod    PaymentMethod @relation(fields: [paymentMethodId], references: [id], onDelete: Cascade)
    minInstallments  Int           @default(1)
    maxInstallments  Int           @default(1)
    feePercentage    Float
    customerInterest Boolean       @default(false)
    receiveInDays    Int?
    createdAt        DateTime      @default(now())

    @@schema("financial")
}

